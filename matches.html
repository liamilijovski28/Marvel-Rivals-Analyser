<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Match History</title>
  <link rel="stylesheet" href="style_Izzy.css">
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <ul>
      <li><a href="#home" class="active">Home</a></li>
      <li><a href="#friends">Friends</a></li>
      <li><a href="#heroes">Heroes</a></li>
      <li><a href="#matches">Matches</a></li>
      <li><a href="#compare">Compare</a></li>
    </ul>
  </nav>

  <!-- Profile Header Section -->
  <section id="profile-header">
    <div id="profile-banner">
      <img src="images\marvel-rivals-image-of-characters-with-captain-america-in-front.avif" alt="Profile Banner" class="banner-img" />
      <div id="overlay"></div>
      <div id="profile-info-wrapper">
        <div id="profile-picture">
          <img src="images\profilepic.jpg" alt="Profile Picture" />
        </div>
        <div id="player-meta">
          <h1 id="playerName">Alfajer</h1>
          <p><span class="eye"></span> 882 Views</p>
        </div>
      </div>
    </div>
  </section>
  

  <!-- Matches Section -->
  <div id="matches"></div>

  <script>
    const username = "Alfajer"; // Change this to test with different users
    const heroMap = {};

    async function loadHeroes() {
      const res = await fetch("https://marvelrivalsapi.com/api/v1/heroes", {
        headers: {
          "x-api-key": "ccf74de6849fcbe1395ded29bf92d33f43dd4df5032448fb7c01bce02f025a29"
        }
      });
      const heroes = await res.json();
      heroes.forEach(h => heroMap[h.hero_id] = h.hero_name);
    }

    async function loadMatches() {
      const res = await fetch(`http://127.0.0.1:5000/api/player/${username}/matches`);
      const data = await res.json();
      const container = document.getElementById("matches");
      const playerTitle = document.getElementById("playerName");

      playerTitle.textContent = `${username}`;

      if (!data.match_history) {
        container.innerHTML = "No match history.";
        return;
      }

      data.match_history.forEach(match => {
        const player = match.match_player;
        const heroId = player.hero_id;
        const heroName = player.player_hero ? player.player_hero.hero_name : "Unknown";  
        const playerCamp = player.camp;
        const matchWinner = match.match_winner_side;
        const isWin = playerCamp !== null && matchWinner !== null && playerCamp === matchWinner ? "Victory" : "Defeat";
        const kda = `${player.kills}/${player.deaths}/${player.assists}`;

        // Extract the add_score from the match data correctly
        const scoreInfo = player.score_info; 
        let rs = scoreInfo ? (scoreInfo.add_score || "Not Available") : "Not Available"; 

        if (typeof rs === "number") {
          rs = Math.round(rs);
        }

        const date = new Date(match.match_time_stamp * 1000).toLocaleString();

        const div = document.createElement("div");
        div.className = "match-card";
        div.innerHTML = `
          <div class="match-info-left">
            <img src="images/hero_placeholder.png" alt="${heroName}" class="hero-icon">
            <div>
              <strong class="hero-name">${heroName}</strong>
              <span class="result ${isWin === "Victory" ? 'win' : 'loss'}">${isWin}</span>
            </div>
          </div>
          <div class="match-stats">
            <p class="kda">K/D/A: ${kda}</p>
            <p class="rs-change">RS Change: ${rs}</p>
            <p class="date">Date: ${date}</p>
          </div>
        `;
        container.appendChild(div);
      });
    }

    (async () => {
      await loadHeroes();
      await loadMatches();
    })();
  </script>
</body>
</html>
